# 蛍光灯 点灯シミュレータ

蛍光灯の「ため → 点灯 → 安定化」を簡易モデルで再現するブラウザアプリです。電源オンで自動生成される点灯シーケンスをキャンバス上に描画し、スライダーで見た目の特性を調整できます。効果音とハム音も再生されます（ユーザー操作後）。

## 🎯 主な特徴

- **自動生成される点灯シーケンス**: 電源ON時に物理風のフリッカーをランダム生成
- **リアルタイム描画**: Canvasで高速レンダリング、スライダー操作が即時反映
- **サウンド演出**: 立ち上がり時のフラッシュ音、明るさに応じたハム音（WebAudio/HTMLAudio）
- **シンプルUI**: 電源スイッチと2つのスライダーのみ

※ 旧バージョンにあった「タイムライン編集UI」や「動画出力」は現在の実装にはありません。

## 🚀 使い方

1. `index.html` をブラウザで開く（ローカルでOK）
2. 画面左上のスイッチを ON にすると、点灯アニメーションが開始されます
3. 以下のスライダーで見た目を調整できます
   - Aspect: キャンバスの横:縦比（10〜32、既定16:1）
   - PeakPos: 端ピーク位置のスケール（0.10〜1.00）。値が大きいほど端寄りにピークが出やすくなります
4. OFF にすると再生停止とリセットが行われます

操作は即時にプレビューへ反映されます。

## 🎚 パラメータ詳細

- **電源スイッチ**: 点灯シーケンスの生成・再生を開始/停止します
- **Aspect**: キャンバスの表示アスペクト（描画解像度も連動）
- **PeakPos**: ピーク位置のスケール。内部的には `1 / k` を用いて左右端寄り/中央寄りをコントロールします

## 🔊 オーディオについて

- 初回のクリック/キー操作以降にオーディオが有効になります（ブラウザの自動再生ポリシー対応）
- 点灯ピーク検知で `flash.wav` を再生します
- ハム音（100Hz/200Hz）を生成し、明るさの平均に応じて音量が自動変化します
- ローカルファイル（`file:`）で開いた場合は HTMLAudio をフォールバックとして使用します

## 🧩 構成（主要ファイル）

```
fluorescent_simulator/
├── index.html      # 画面とUI
├── styles.css      # スタイル
├── app.js          # アプリ本体。描画、UI連携、電源操作
├── player.js       # 再生・補間とピーク位置スケール
├── generator.js    # 点灯シーケンスの自動生成（乱数シード対応）
├── audio.js        # フラッシュ効果音とハム音の制御
├── colormap.js     # 明るさ→色温度(色)の変換
├── utils.js        # 便利関数（clamp 等）
└── flash.wav       # フラッシュ効果音
```

## 🧪 動作環境

- モダンブラウザ（Chrome / Firefox / Safari / Edge）
- PC/モバイルともに動作想定。音声はユーザー操作後に有効

## 🔧 カスタマイズのヒント

- 点灯挙動の編集: `generator.js` のパラメータを調整
- 色味の変更: `colormap.js` で出力色を調整
- 初期キー フレーム: `app.js` の `initDefaultKeyframes()` / 電源ON時の `powerOn()` を参照

---

このシミュレータは教育・研究目的の簡易モデルです。実機の挙動とは異なる場合があります。
